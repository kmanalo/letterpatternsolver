<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>5-Letter Word Solver | LetterPatternSolver</title>

<style>
:root{
  --bg:#f4f7f8;
  --card:#ffffff;
  --ink:#12343b;
  --muted:#6b7c80;
  --accent:#0f4c5c;
  --accent2:#0c3b4a;
  --border:#d9e2e6;
  --shadow: 0 10px 30px rgba(0,0,0,0.08);
}

*{ box-sizing:border-box; }

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  background:var(--bg);
  color:var(--ink);
  padding:18px;
}

.container{
  max-width:560px;
  margin:0 auto;
}

.card{
  background:var(--card);
  border-radius:22px;
  padding:22px;
  box-shadow:var(--shadow);
  border:1px solid rgba(0,0,0,0.03);
}

h1{
  text-align:center;
  margin:0 0 6px;
  font-size:34px;
}

.subtitle{
  text-align:center;
  color:var(--muted);
  font-size:15px;
  margin-bottom:10px;
}

.topline{
  display:flex;
  justify-content:center;
  gap:10px;
  flex-wrap:wrap;
  margin-bottom:10px;
}

.badge{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 10px;
  border:2px solid var(--border);
  border-radius:12px;
  background:#fff;
  font-size:14px;
  color:var(--muted);
}

.toggle{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 10px;
  border:2px solid var(--border);
  border-radius:12px;
  background:#fff;
  font-size:14px;
  color:var(--muted);
}
.toggle input{ transform: scale(1.1); }

.boxes{
  display:flex;
  justify-content:center;
  gap:8px;
  margin:16px 0 10px;
}

.box{
  width: clamp(44px, calc((100vw - 18px*2 - 22px*2 - 8px*4) / 5), 72px);
  height: clamp(44px, calc((100vw - 18px*2 - 22px*2 - 8px*4) / 5), 72px);
  border:2px solid var(--border);
  border-radius:14px;
  background:white;
  text-align:center;
  font-size: clamp(18px, 5vw, 30px);
  font-weight:650;
  outline:none;
  text-transform:uppercase;
  -webkit-appearance:none;
}
.box:focus{
  border-color:rgba(15,76,92,.55);
  box-shadow: 0 0 0 4px rgba(15,76,92,.12);
}

#patternRow{ display:none; }

label{
  font-size:13px;
  color:var(--muted);
  display:block;
  margin-top:12px;
  margin-bottom:6px;
  letter-spacing:0.4px;
}

input.text{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:2px solid var(--border);
  font-size:16px;
  outline:none;
}

.actions{
  display:flex;
  gap:10px;
  margin-top:16px;
}

button{
  flex:1;
  padding:14px 12px;
  border:none;
  border-radius:16px;
  font-size:18px;
  font-weight:700;
  cursor:pointer;
}

button.primary{
  color:white;
  background:linear-gradient(180deg,var(--accent),var(--accent2));
  box-shadow:0 14px 30px rgba(15,76,92,0.18);
}
button.secondary{
  background:#fff;
  color:var(--accent);
  border:2px solid var(--border);
}

button:active{ transform: translateY(1px); }

.meta{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:14px;
  color:var(--muted);
  font-size:14px;
}

.meta a{
  cursor:pointer;
  text-decoration:underline;
  color:var(--muted);
}

.words{
  margin-top:12px;
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
}

.word{
  padding:10px;
  border-radius:12px;
  border:2px solid var(--border);
  text-align:center;
  font-weight:700;
  letter-spacing:2px;
  cursor:pointer;
  user-select:none;
  background:#fff;
}

.status{
  margin-top:10px;
  text-align:center;
  font-size:13px;
  color:var(--muted);
}

.footer{
  margin-top:18px;
  text-align:center;
  font-size:13px;
  color:var(--muted);
}
.footer a{ color:var(--muted); }

@media (max-width: 430px){
  h1{ font-size:28px; }
  .words{ grid-template-columns:repeat(2,1fr); }
}
</style>
</head>

<body>
<div class="container">
  <div class="card">

    <h1>5-Letter Word Solver</h1>
    <div class="subtitle">Wordle-style filtering (5 letters)</div>

    <div class="topline">
      <span class="badge">Wordle (5 letters)</span>

      <label class="toggle" title="Answers only searches the official solution list. All valid guesses includes accepted non-solution words too.">
        <input type="checkbox" id="useAll">
        All valid guesses
      </label>
    </div>

    <div class="boxes" id="boxes" aria-label="Pattern boxes"></div>

    <!-- Hidden pattern input kept only for internal syncing -->
    <div id="patternRow">
      <input id="pattern" class="text" placeholder="_____" maxlength="5" autocapitalize="none" spellcheck="false" />
    </div>

    <label>Include letters</label>
    <input id="include" class="text" autocapitalize="none" spellcheck="false" placeholder="e.g. rt" />

    <label>Exclude letters</label>
    <input id="exclude" class="text" autocapitalize="none" spellcheck="false" placeholder="e.g. snl" />

    <div class="actions">
      <button class="primary" id="doneBtn">Done</button>
      <button class="secondary" id="resetBtn">Reset</button>
    </div>

    <div class="meta">
      <span id="count">Loading…</span>
      <a id="clearResultsLink">Clear results</a>
    </div>

    <div class="words" id="results"></div>
    <div class="status" id="status">Loading word lists…</div>

    <div class="footer">
      <a href="/privacy.html">Privacy</a> |
      <a href="/about.html">About</a> |
      <a href="/contact.html">Contact</a>
      <br><br>
      Not affiliated with Wordle or The New York Times
    </div>

  </div>
</div>

<script>
const $ = (id) => document.getElementById(id);

let ANSWERS = [];
let ALLOWED = [];
let READY = false;

let searchTimer = null;
const DEBOUNCE_MS = 180;

function parse(text){
  return text
    .split(/\r?\n/)
    .map(x => x.trim().toLowerCase())
    .filter(x => /^[a-z]{5}$/.test(x));
}

async function loadLists(){
  try{
    const a = await fetch("/data/answers.txt", { cache: "no-store" });
    const b = await fetch("/data/allowed.txt", { cache: "no-store" });

    if(!a.ok) throw new Error("Missing /data/answers.txt");
    if(!b.ok) throw new Error("Missing /data/allowed.txt");

    ANSWERS = parse(await a.text());
    ALLOWED = parse(await b.text());

    READY = true;

    $("status").innerText =
      `Loaded ${ANSWERS.length.toLocaleString()} answers + ${ALLOWED.length.toLocaleString()} guesses.`;

    // Restore prior state (if any)
    try{
      const s = JSON.parse(localStorage.getItem("lps_state") || "{}");
      if (typeof s.useAll === "boolean") $("useAll").checked = s.useAll;
      if (typeof s.include === "string") $("include").value = s.include;
      if (typeof s.exclude === "string") $("exclude").value = s.exclude;
      if (typeof s.pat === "string") setBoxesFromPattern(s.pat);
      else setBoxesFromPattern("_____");
    }catch{
      setBoxesFromPattern("_____");
    }

    // Do NOT show huge list on load
    $("count").innerText = "Enter letters to search";
    $("results").innerHTML = "";

    // Optionally: if you want it to run immediately ONLY when state has constraints,
    // scheduleSearch() will handle it correctly.
    scheduleSearch();
  }catch(err){
    $("status").innerText = "Word lists failed to load: " + err.message;
    $("count").innerText = "Error loading word lists";
  }
}

function setBoxesFromPattern(patRaw){
  const pat = (patRaw || "")
    .toLowerCase()
    .replace(/[^a-z_]/g, "")
    .padEnd(5,"_")
    .slice(0,5);

  const boxes = $("boxes");
  boxes.innerHTML = "";

  for(let i=0;i<5;i++){
    const inp = document.createElement("input");
    inp.className = "box";
    inp.type = "text";
    inp.maxLength = 1;
    inp.inputMode = "text";
    inp.autocomplete = "off";
    inp.autocapitalize = "characters";
    inp.spellcheck = false;
    inp.dataset.idx = String(i);

    inp.value = (pat[i] === "_" ? "" : pat[i].toUpperCase());

    inp.addEventListener("input", () => {
      inp.value = (inp.value || "").replace(/[^a-zA-Z]/g, "").slice(0,1).toUpperCase();

      // auto-advance
      if(inp.value && i < 4){
        boxes.querySelector(`input.box[data-idx="${i+1}"]`)?.focus();
      }

      scheduleSearch();
    });

    inp.addEventListener("keydown", (e) => {
      if(e.key === "Backspace" && !inp.value && i > 0){
        boxes.querySelector(`input.box[data-idx="${i-1}"]`)?.focus();
      }
    });

    inp.addEventListener("focus", () => setTimeout(() => inp.select(), 0));

    boxes.appendChild(inp);
  }

  $("pattern").value = pat;
}

function patternFromBoxes(){
  const inputs = Array.from(document.querySelectorAll("input.box"));
  const pat = inputs.map(x => {
    const v = (x.value || "").toLowerCase();
    return /^[a-z]$/.test(v) ? v : "_";
  }).join("");

  $("pattern").value = pat;
  return pat;
}

function getList(){
  if(!$("useAll").checked) return ANSWERS;
  const set = new Set(ANSWERS);
  for(const w of ALLOWED) set.add(w);
  return Array.from(set);
}

function hasConstraints(pat, include, exclude){
  return (pat !== "_____") || (include.length > 0) || (exclude.length > 0);
}

function scheduleSearch(){
  if(!READY) return;

  if(searchTimer) clearTimeout(searchTimer);
  searchTimer = setTimeout(() => {
    solve();
  }, DEBOUNCE_MS);
}

function solve(){
  if(!READY) return;

  const pat = patternFromBoxes();
  const includeRaw = ($("include").value || "").toLowerCase();
  const excludeRaw = ($("exclude").value || "").toLowerCase();

  const include = includeRaw.replace(/[^a-z]/g, "");
  const exclude = excludeRaw.replace(/[^a-z]/g, "");

  if(!hasConstraints(pat, include, exclude)){
    $("results").innerHTML = "";
    $("count").innerText = "Enter letters to search";
    saveState(pat);
    return;
  }

  const list = getList();

  const results = list.filter(word => {
    // pattern
    for(let i=0;i<5;i++){
      if(pat[i] !== "_" && word[i] !== pat[i]) return false;
    }
    // include
    for(const c of include){
      if(!word.includes(c)) return false;
    }
    // exclude
    for(const c of exclude){
      if(word.includes(c)) return false;
    }
    return true;
  }).sort();

  $("count").innerText = `${results.length} viable words`;

  const container = $("results");
  container.innerHTML = "";

  for(const w of results){
    const d = document.createElement("div");
    d.className = "word";
    d.innerText = w.toUpperCase();
    d.addEventListener("click", async () => {
      try{
        await navigator.clipboard.writeText(w);
        $("status").innerText = `Copied ${w.toUpperCase()} to clipboard.`;
        setTimeout(() => {
          $("status").innerText = `Loaded ${ANSWERS.length.toLocaleString()} answers + ${ALLOWED.length.toLocaleString()} guesses.`;
        }, 1200);
      }catch{
        // clipboard may fail in some iOS contexts
      }
    });
    container.appendChild(d);
  }

  saveState(pat);
}

function saveState(pat){
  localStorage.setItem("lps_state", JSON.stringify({
    useAll: $("useAll").checked,
    include: $("include").value,
    exclude: $("exclude").value,
    pat
  }));
}

function dismissKeyboardAndScroll(){
  // Dismiss keyboard
  document.activeElement?.blur();

  // If results exist, scroll them into view
  const results = $("results");
  if(results && results.children.length > 0){
    results.scrollIntoView({ behavior: "smooth", block: "start" });
  }
}

function clearResults(){
  $("results").innerHTML = "";
  $("count").innerText = "Enter letters to search";
}

function resetAll(){
  $("include").value = "";
  $("exclude").value = "";
  $("useAll").checked = false;
  localStorage.removeItem("lps_state");

  setBoxesFromPattern("_____");
  clearResults();

  if (READY) $("status").innerText =
    `Loaded ${ANSWERS.length.toLocaleString()} answers + ${ALLOWED.length.toLocaleString()} guesses.`;
}

document.addEventListener("DOMContentLoaded", () => {
  setBoxesFromPattern("_____");

  $("include").addEventListener("input", scheduleSearch);
  $("exclude").addEventListener("input", scheduleSearch);
  $("useAll").addEventListener("change", scheduleSearch);

  $("doneBtn").addEventListener("click", () => {
    dismissKeyboardAndScroll();
  });

  $("resetBtn").addEventListener("click", resetAll);

  $("clearResultsLink").addEventListener("click", () => {
    clearResults();
    saveState(patternFromBoxes());
  });

  loadLists();
});
</script>

</body>
</html>
